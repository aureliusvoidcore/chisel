# HW-CBMC (EBMC) – WebAssembly build

This folder contains the WebAssembly build of EBMC (hw-cbmc) and a thin JS wrapper used by the site UI.

Artifacts generated by the build script:
- hwcbmc.js – Emscripten loader/module factory (MODULARIZE=1, EXPORT_NAME=HWCBMCModule)
- hwcbmc.wasm – WebAssembly binary
- hwcbmc-wrapper.js – small helper for FS IO and callMain
 - ic3_enabled.txt – marker file indicating the build includes IC3 (used by the UI for auto‑detection)

## Build

Prerequisites:
- Emscripten SDK (emsdk) activated in your environment
- Native build tools (flex, bison) available for parser generation

Build command (runs full pipeline and links wasm):

	bash scripts/build_hwcbmc_wasm.sh

The script first generates a few header artifacts natively (ansi-c, cpp) and then compiles the core CBMC libraries and EBMC sources with em++.

Environment switches:

- HWCBMC_WASM_FORCE_CLEAN=1 — force a full clean of CBMC libs/EBMC objs before building (default: 0)
- HWCBMC_WASM_ENABLE_IC3=1 — include the IC3 engine in the build (default: 0 to keep download smaller)
- HWCBMC_WASM_LENIENT_LINK=1 — allow undefined symbols at link time (default: 0)

Notes:
- IC3 is disabled by default to keep the binary small and speed up builds. Enable via the env switch above if you need `--ic3`. When enabled, the build drops `ic3_enabled.txt` so the UI can enable the IC3 radio automatically.
- External solver processes are not supported in the browser; EBMC will use its internal SAT/BV solvers compiled into the wasm.

## Using in the UI

The page `pages/formal-verification-hwcbmc.html` loads `hwcbmc_build/hwcbmc.js`, `hwcbmc_build/hwcbmc-wrapper.js`, and `assets/js/hwcbmc-ui.js`.
Open the page at `/pages/formal-verification/hwcbmc` and paste or upload a small Verilog/VHDL example, then click "Run EBMC".

## Troubleshooting

- If you see "HWCBMCModule factory not found", ensure `hwcbmc.js` exists and is served by your local HTTP server.
- If the wasm fails to instantiate due to memory, try lowering `-O2` to `-O1` or enabling `-s INITIAL_MEMORY=...` in the script.
- For very large designs, the browser build may run out of memory or time. Start with small bounded checks.
